<idea-plugin>
    <id>com.zzf.rikki.idea</id>
    <name>Rikki Code Agent</name>
    <vendor email="zhengzhengfeng@outlook.com" url="https://github.com/Creeper5261/Rikki">Creeper5261</vendor>

    <idea-version since-build="241"/>

    <description><![CDATA[
        Rikki is a lightweight AI coding assistant for JetBrains IDEs.<br>
        No backend server required — connects directly to LLM APIs.<br><br>

        <b>Chat Agent</b><br>
        An AI panel that can read files, write and edit code, run terminal commands,
        and perform Git operations. High-risk commands (file deletion, force-push, etc.)
        always pause for your explicit Approve / Skip confirmation before executing.<br><br>

        <b>Inline TAB Completion</b><br>
        Ghost-text suggestions appear as you type; press TAB to accept.<br>
        <ul>
            <li><b>FIM mode</b> (Fill-In-Middle) for DeepSeek and Ollama — sends prefix + suffix
                directly to the model's dedicated completions endpoint for accurate in-place suggestions.</li>
            <li><b>Chat-format fallback</b> for OpenAI, Gemini, Moonshot, and other providers.</li>
            <li>Completion can use a <b>different provider, model, and API key</b> than the chat agent
                — ideal for using a fast/cheap model for completions and a powerful model for chat.</li>
        </ul>

        <b>Multi-Provider Support</b><br>
        Built-in presets for DeepSeek, OpenAI (GPT), Anthropic (Claude), Google Gemini,
        Moonshot / Kimi, Ollama (local, no key required), and fully custom endpoints.<br>
        Each provider stores its own API key — switching provider automatically loads the correct key.<br><br>

        <b>Setup</b><br>
        Open <b>Settings → Tools → Rikki Code Agent</b>, choose your provider, enter the API key,
        and select a model. For local use, choose Ollama — no API key needed.
    ]]></description>

    <change-notes><![CDATA[
        <b>0.1.0</b> — Initial release
        <ul>
            <li>AI chat panel with file read/write, terminal execution, and Git operations</li>
            <li>High-risk command confirmation: agent pauses and waits for Approve / Skip</li>
            <li>Inline TAB completion with FIM support (DeepSeek beta, Ollama) and chat-format
                fallback (OpenAI, Gemini, Moonshot)</li>
            <li>Per-provider API keys: DeepSeek, OpenAI, Anthropic, Gemini, Moonshot, Ollama, Custom</li>
            <li>Independent completion provider — choose a different model/key/URL for completions</li>
            <li>deepseek-reasoner (R1): reasoning_content carried in multi-turn history</li>
            <li>OpenAI o1 / o3 / o4 dialect: developer role, max_completion_tokens, tools toggle</li>
        </ul>
    ]]></change-notes>

    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.java</depends>

    <extensions defaultExtensionNs="com.intellij">
        <applicationService serviceImplementation="com.zzf.rikki.idea.settings.RikkiSettings"/>
        <applicationConfigurable
            parentId="tools"
            instance="com.zzf.rikki.idea.settings.RikkiSettingsConfigurable"
            id="com.zzf.rikki.idea.settings.RikkiSettingsConfigurable"
            displayName="Rikki Code Agent"/>
        <projectService serviceImplementation="com.zzf.rikki.idea.IdeBridgeServer"/>
        <toolWindow id="Rikki" anchor="right"
                    icon="/icons/toolWindowRikki.svg"
                    factoryClass="com.zzf.rikki.idea.ChatToolWindowFactory"/>
        <inline.completion.provider
            implementation="com.zzf.rikki.idea.completion.RikkiInlineCompletionProvider"
            order="last"/>
    </extensions>

    <actions>
        <action id="Rikki.TriggerCompletion"
                class="com.zzf.rikki.idea.completion.RikkiTriggerCompletionAction"
                text="Trigger Rikki AI Completion"
                description="Manually trigger Rikki inline AI completion at cursor">
            <keyboard-shortcut keymap="$default" first-keystroke="alt BACK_SLASH"/>
        </action>
    </actions>
</idea-plugin>
